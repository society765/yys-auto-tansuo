# 阴阳师自动探索脚本

网易阴阳师电脑版，按键精灵9脚本，自动探索，刷狗粮。

This is a script, written using Anjianjingling 9, for automated EXP farming in Netease game Onmyoji, PC emulator version. 

## 准备工作

玩家需自行下载网易阴阳师电脑版，并登录至游戏内。

该脚本为本人修仙时间使用按键精灵9.21.10865版本编写，玩家需自行下载按键精灵，并将代码 [yys-auto-tansuo.Q](yys-auto-tansuo.Q) 拷贝后导入使用。如果导入源代码文件没有添加附件，请手动添加 [/img](/img) 文件夹下的图片为脚本附件。 

2018年4月14日，上传了本地 阴阳师电脑版 沙盒双开 的组队探索脚本，使用了开源的 [天使插件](http://bbs.tyuyan.net/thread-45659-1-1.html) ， 该双开脚本支持完全后台。使用该双开脚本需要同时下载 [TSPlug.dll](TSPlug.dll) 和 [RegDll.dll](RegDll.dll) 并在按键精灵程序中手动将其添加至附件。

## 使用方法及功能简介

玩家需要先进入探索大地图，并且将鼠标指针置于阴阳师窗口内，然后可以使用键盘快捷键(默认 F10)开始运行脚本，之后可以将鼠标移走。由于使用了找色函数，所以阴阳师窗口全程不能被遮挡，可能会在将来更新为后台找色。该脚本使用了鼠标后台点击函数，所以在运行过程中不会有鼠标漂移或乱点现象。

推荐使用破势玉藻前带2狗粮探索，目前的版本不支持点怪，可能会在以后添加。玩家的狗粮队长需要保证能在自动模式下打败敌人。

玩家需要将玉藻前(或其他狗粮队长)置于中间式神位置并开启妖术，两个狗粮式神分别置于左右位置。战斗系统使用自动，并取消勾选“锁定出战阵容”。当狗粮满级时，系统会有弹出窗口提示，玩家需要手动更换狗粮后，点击弹出窗口的“确定”按钮以继续脚本。

目前该脚本会无视石距，年兽，妖气封印，而直接进行下一次的探索。添加了探索后点击大地图的宝箱点击功能。

该脚本仅使用了画面找色，找图，鼠标后台点击的函数，完全模拟人类玩家行为，没有使用任何内存读写函数。在敏感位置添加了均匀分布的随机时间漂移，和随机坐标漂移。作者使用过该脚本几千体力仍没有收到鬼使黑来信，而且作者不对您的可能存在的任何被封禁结果负责。  

玩家可以在任何时刻使用键盘快捷键结束脚本(默认 F12)。

感谢您使用该脚本，并欢迎各种反馈和改进意见。 

### 2018.04.14 本地双开按键精灵脚本

切记在运行前需要将两个 dll 库在按键精灵中添加至附件。

我直接使用了窗口名称来查找大号和小号分别对应的窗口，如果你的两个窗口名称一致或存在其他问题，请在源码中对应位置将 ts.FindWindow() 函数注释掉，并使用 Plugin.Window.SearchEx() 函数，
或者其他函数, e.g. Plugin.Window.MousePoint(), 来寻找窗口。

在运行脚本前，大号进入探索灯笼，小号点开探索界面，就是有 "普通", "困难", "组队", "探索" 的小窗体，然后点击 F10 运行脚本。 第一次脚本会在小号（司机）界面点击组队，玩家需要手动邀请大号（3狗粮），
并点击"邀请"。 之后脚本会自动接受邀请，并开始探索。

该脚本支持探索界面自动点怪，如需要手动点怪，可以将源码中的 autoclick 变量改为 0. 另外脚本添加了一个试验功能，会尝试优先点击经验怪，并不保证完全靠谱，如不需要该功能，可将 findexptest 变量改为 0.

在任意一次探索结束后，如果是正常打boss结束，脚本会自动再次邀请大号，无需额外操作。如果是因为脚本没找到怪物而提前退出了探索，玩家需要再次手动点击来邀请大号。

## 已知存在的问题

*  由于探索地图长于一个屏幕，可能会在最后只剩1～2只怪的时候找不到他们，脚本会在一定次数的尝试后退出当前探索，开启新一轮探索。
*  目前无法选择怪物携带加成 （经验/金币/掉落），脚本会随机选择视野范围内的怪物来战斗。
*  脚本会优先选择BOSS战，优于剩下的小怪。
*  暂无处理经验酒壶装满之后的系统对话框的部分，可能导致脚本乱点，或卡死。
*  如果玩家发现在任何时刻脚本出现乱点击或卡死现象，建议结束脚本，然后手动回到大地图的初始状态，重新开始脚本。 
*  目前暂无探测体力耗尽，或达到电脑版每日探索次数上限的功能/函数，建议手动停止脚本。
*  在获取大地图宝箱后，有一定几率乱点，导致进入其他妖气界面，建议手动停止脚本。
*  如果玩家系统有多显示器，阴阳师窗口不能置于负数坐标下。源码中的stx, sty变量为阴阳师窗口左上角的坐标，暂时不可以修改。如果阴阳师窗口处于负坐标下，找色函数会返回错误值。
*  作者使用Windows 7系统，桌面分辨率1920*1080，并没有在其他系统或分辨率测试过兼容性。

### 2018.04.14 本地双开按键精灵脚本

* 在 Windows 7 环境下，玩家需要以管理员身份运行阴阳师游戏窗口。而且，需要调整系统的画面设置： 右键我的电脑 -> 高级系统设置 -> 高级 -> 设置 -> 取消勾选以下3项： "启用 Aero peek"，"启用透明玻璃"，和"启用桌面组合"。
* 暂不支持更换满级狗粮，玩家在挂机时可以大小号都锁定 "固定阵容"。如需更换狗粮，可以解锁 "固定阵容"，进入战斗更换后再重新锁定。
* 暂不支持拒绝悬赏，请手动接受或拒绝。

## 更新记录

2018年1月13日，上传了初始版本。

2018年2月11日，添加了对探索25章的支持；现在可以自动拒绝一切悬赏；满级狗粮的提示功能不完善，经常会不提示，需要玩家人工观察并更换狗粮。

2018年2月16日，重写编写了满级狗粮检测部分，可靠性提高。

2018年4月14日，上传了按键精灵的本地双开探索脚本，使用了天使插件来达成全后台功能。

## Disclaimer

网易，阴阳师，是网易公司的商标。 http://yys.163.com

按键精灵，是按键精灵公司的商标。 http://www.anjian.com

开源的 [天使插件](http://bbs.tyuyan.net/thread-45659-1-1.html)，该插件由 C++ 编写，用户可以前往他们的站点下载源代码，作者只是调用了预编译好的 dll 库。
并请参考开发组的 License.

<!-- 根据 [GPLv3](https://www.gnu.org/licenses/gpl-3.0.html) 开源协议，本人不对该脚本负任何责任。-->

## 协议 (License)

该源代码使用了 [GPLv3](https://www.gnu.org/licenses/gpl-3.0.html) 开源协议。

This project is licensed under the [GPLv3](https://www.gnu.org/licenses/gpl-3.0.html) license.

